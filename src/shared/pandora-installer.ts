import { LitElement, html } from "lit";
import { customElement, property } from "lit/decorators.js";
import { TW } from "./tailwindMixin";

// Default enabled tiles
import "../tiles/pandora-link";

const TwLitElement = TW(LitElement);

@customElement("pandora-installer")
export class PandoraInstaller extends TwLitElement {
  @property({ type: String, attribute: "site-id" }) siteId = "";

  private handleOnCreateLinkClick() {
    const link = prompt("Enter the link you want to create") ?? "";

    // TODO check if is link using Regex
    if (link) {
      const data = {
        property: this.siteId,
        type: "pandora-link",
        attributes: {
          id: `pandora-link-${link}`,
          label: `Link to ${link} website`,
          component: "pandora-link",
          icon: `<img src="https://www.google.com/s2/favicons?domain_url=${link}"></img>`,
          link: link,
        },
      };

      document.dispatchEvent(
        new CustomEvent("pandora::register-tile", {
          detail: data,
          bubbles: true,
        })
      );
    }
  }

  render() {
    return html`
      <svg
        @click="${this.handleOnCreateLinkClick}"
        class="size-6 cursor-pointer"
        viewBox="0 0 14 13"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M9.3717 4.14637C9.41819 4.1928 9.45507 4.24794 9.48023 4.30864C9.50539 4.36934 9.51834 4.4344 9.51834 4.5001C9.51834 4.56581 9.50539 4.63087 9.48023 4.69157C9.45507 4.75226 9.41819 4.80741 9.3717 4.85384L5.37183 8.85371C5.32538 8.90016 5.27023 8.93701 5.20954 8.96215C5.14884 8.98729 5.08379 9.00023 5.0181 9.00023C4.9524 9.00023 4.88735 8.98729 4.82665 8.96215C4.76596 8.93701 4.71081 8.90016 4.66436 8.85371C4.6179 8.80726 4.58106 8.75211 4.55591 8.69141C4.53077 8.63072 4.51783 8.56567 4.51783 8.49997C4.51783 8.43428 4.53077 8.36922 4.55591 8.30853C4.58106 8.24783 4.6179 8.19269 4.66436 8.14623L8.66422 4.14637C8.71066 4.09988 8.7658 4.063 8.8265 4.03784C8.8872 4.01268 8.95226 3.99973 9.01796 3.99973C9.08367 3.99973 9.14873 4.01268 9.20943 4.03784C9.27012 4.063 9.32527 4.09988 9.3717 4.14637ZM12.4928 1.02522C12.1678 0.700187 11.782 0.442355 11.3574 0.266447C10.9327 0.090539 10.4776 0 10.0179 0C9.55829 0 9.10315 0.090539 8.6785 0.266447C8.25385 0.442355 7.86801 0.700187 7.54301 1.02522L5.66432 2.90328C5.57051 2.9971 5.5178 3.12434 5.5178 3.25702C5.5178 3.3897 5.57051 3.51694 5.66432 3.61076C5.75814 3.70457 5.88538 3.75728 6.01806 3.75728C6.15074 3.75728 6.27798 3.70457 6.3718 3.61076L8.25049 1.73582C8.72103 1.27562 9.35407 1.01954 10.0122 1.02317C10.6704 1.02679 11.3006 1.28982 11.766 1.75518C12.2315 2.22054 12.4946 2.85067 12.4983 3.50884C12.5021 4.167 12.2461 4.80008 11.786 5.2707L9.90668 7.14939C9.81287 7.24313 9.76013 7.37029 9.76007 7.50291C9.76001 7.63553 9.81264 7.76274 9.90637 7.85655C10.0001 7.95037 10.1273 8.00311 10.2599 8.00317C10.3925 8.00323 10.5197 7.9506 10.6135 7.85687L12.4928 5.97505C12.8179 5.65006 13.0757 5.26422 13.2516 4.83957C13.4275 4.41492 13.5181 3.95978 13.5181 3.50014C13.5181 3.0405 13.4275 2.58536 13.2516 2.16071C13.0757 1.73606 12.8179 1.35022 12.4928 1.02522ZM7.66426 9.38869L5.78557 11.2674C5.55438 11.5038 5.27859 11.6919 4.97417 11.821C4.66975 11.9501 4.34276 12.0175 4.01211 12.0193C3.68147 12.0211 3.35375 11.9573 3.04793 11.8316C2.74211 11.7059 2.46426 11.5208 2.23048 11.287C1.9967 11.0531 1.81162 10.7753 1.68597 10.4694C1.56032 10.1636 1.49659 9.83584 1.49847 9.5052C1.50035 9.17455 1.5678 8.84757 1.69692 8.54317C1.82604 8.23878 2.01426 7.96302 2.25069 7.73187L4.12875 5.85381C4.22257 5.75999 4.27527 5.63275 4.27527 5.50007C4.27527 5.36739 4.22257 5.24015 4.12875 5.14633C4.03493 5.05251 3.90769 4.99981 3.77501 4.99981C3.64233 4.99981 3.51509 5.05251 3.42127 5.14633L1.54321 7.02502C0.886822 7.68141 0.518066 8.57166 0.518066 9.49994C0.518066 10.4282 0.886822 11.3185 1.54321 11.9749C2.1996 12.6312 3.08985 13 4.01813 13C4.9464 13 5.83666 12.6312 6.49305 11.9749L8.37173 10.0955C8.46547 10.0017 8.5181 9.87452 8.51804 9.7419C8.51798 9.60928 8.46524 9.48211 8.37142 9.38838C8.2776 9.29464 8.15039 9.24202 8.01777 9.24208C7.88516 9.24214 7.75799 9.29487 7.66426 9.38869Z"
          fill="currentColor"
        />
      </svg>
    `;
  }
}

// Register the tile directly using the static method
customElements.whenDefined("pandora-box").then(() => {
  (customElements.get("pandora-box") as any).registerTile({
    id: "pandora-installer",
    label: "Installer Tile",
    component: "pandora-installer",
    icon: `<svg viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.47261 1.31531e-06C2.88826 1.31531e-06 2.31703 0.173282 1.83116 0.497932C1.34528 0.822581 0.966592 1.28402 0.742969 1.82389C0.519347 2.36376 0.460837 2.95782 0.574838 3.53095C0.68884 4.10407 0.970233 4.63052 1.38343 5.04372C1.79663 5.45692 2.32308 5.73832 2.89621 5.85232C3.46934 5.96632 4.0634 5.90781 4.60327 5.68419C5.14314 5.46057 5.60458 5.08188 5.92923 4.596C6.25388 4.11013 6.42716 3.5389 6.42716 2.95455C6.42716 2.17095 6.11588 1.41945 5.56179 0.865367C5.00771 0.311283 4.25621 1.31531e-06 3.47261 1.31531e-06ZM3.47261 4.72727C3.122 4.72727 2.77926 4.6233 2.48774 4.42851C2.19621 4.23372 1.969 3.95686 1.83483 3.63294C1.70065 3.30902 1.66555 2.95258 1.73395 2.6087C1.80235 2.26483 1.97118 1.94896 2.21911 1.70104C2.46703 1.45312 2.7829 1.28428 3.12677 1.21588C3.47065 1.14748 3.82708 1.18259 4.15101 1.31676C4.47493 1.45093 4.75179 1.67815 4.94658 1.96967C5.14137 2.2612 5.24534 2.60393 5.24534 2.95455C5.24534 3.4247 5.05857 3.8756 4.72612 4.20805C4.39367 4.5405 3.94277 4.72727 3.47261 4.72727ZM10.5635 5.90909C11.1479 5.90909 11.7191 5.73581 12.205 5.41116C12.6908 5.08651 13.0695 4.62507 13.2932 4.0852C13.5168 3.54533 13.5753 2.95127 13.4613 2.37814C13.3473 1.80502 13.0659 1.27857 12.6527 0.865367C12.2395 0.452167 11.713 0.170774 11.1399 0.0567721C10.5668 -0.0572297 9.97274 0.00128016 9.43286 0.224903C8.89299 0.448525 8.43155 0.827217 8.10691 1.31309C7.78226 1.79896 7.60897 2.37019 7.60897 2.95455C7.60897 3.73814 7.92026 4.48964 8.47434 5.04372C9.02843 5.59781 9.77993 5.90909 10.5635 5.90909ZM10.5635 1.18182C10.9141 1.18182 11.2569 1.28579 11.5484 1.48058C11.8399 1.67537 12.0671 1.95223 12.2013 2.27615C12.3355 2.60008 12.3706 2.95651 12.3022 3.30039C12.2338 3.64426 12.0649 3.96013 11.817 4.20805C11.5691 4.45597 11.2532 4.62481 10.9094 4.69321C10.5655 4.76161 10.209 4.72651 9.88513 4.59233C9.5612 4.45816 9.28434 4.23094 9.08955 3.93942C8.89476 3.6479 8.79079 3.30516 8.79079 2.95455C8.79079 2.48439 8.97756 2.03349 9.31001 1.70104C9.64246 1.36859 10.0934 1.18182 10.5635 1.18182ZM3.47261 7.09091C2.88826 7.09091 2.31703 7.26419 1.83116 7.58884C1.34528 7.91349 0.966592 8.37493 0.742969 8.9148C0.519347 9.45467 0.460837 10.0487 0.574838 10.6219C0.68884 11.195 0.970233 11.7214 1.38343 12.1346C1.79663 12.5478 2.32308 12.8292 2.89621 12.9432C3.46934 13.0572 4.0634 12.9987 4.60327 12.7751C5.14314 12.5515 5.60458 12.1728 5.92923 11.6869C6.25388 11.201 6.42716 10.6298 6.42716 10.0455C6.42716 9.26186 6.11588 8.51036 5.56179 7.95627C5.00771 7.40219 4.25621 7.09091 3.47261 7.09091ZM3.47261 11.8182C3.122 11.8182 2.77926 11.7142 2.48774 11.5194C2.19621 11.3246 1.969 11.0478 1.83483 10.7238C1.70065 10.3999 1.66555 10.0435 1.73395 9.69961C1.80235 9.35574 1.97118 9.03987 2.21911 8.79195C2.46703 8.54403 2.7829 8.37519 3.12677 8.30679C3.47065 8.23839 3.82708 8.27349 4.15101 8.40767C4.47493 8.54184 4.75179 8.76906 4.94658 9.06058C5.14137 9.3521 5.24534 9.69484 5.24534 10.0455C5.24534 10.5156 5.05857 10.9665 4.72612 11.299C4.39367 11.6314 3.94277 11.8182 3.47261 11.8182ZM13.5181 10.0455C13.5181 10.2022 13.4558 10.3525 13.345 10.4633C13.2342 10.5741 13.0839 10.6364 12.9272 10.6364H11.1544V12.4091C11.1544 12.5658 11.0922 12.7161 10.9814 12.8269C10.8705 12.9377 10.7202 13 10.5635 13C10.4068 13 10.2565 12.9377 10.1457 12.8269C10.0349 12.7161 9.97261 12.5658 9.97261 12.4091V10.6364H8.19988C8.04317 10.6364 7.89286 10.5741 7.78205 10.4633C7.67123 10.3525 7.60897 10.2022 7.60897 10.0455C7.60897 9.88873 7.67123 9.73843 7.78205 9.62762C7.89286 9.5168 8.04317 9.45454 8.19988 9.45454H9.97261V7.68182C9.97261 7.5251 10.0349 7.3748 10.1457 7.26398C10.2565 7.15316 10.4068 7.09091 10.5635 7.09091C10.7202 7.09091 10.8705 7.15316 10.9814 7.26398C11.0922 7.3748 11.1544 7.5251 11.1544 7.68182V9.45454H12.9272C13.0839 9.45454 13.2342 9.5168 13.345 9.62762C13.4558 9.73843 13.5181 9.88873 13.5181 10.0455Z" fill="#E2E2E2"/></svg>`,
  });
});
